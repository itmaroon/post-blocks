{"version":3,"file":"front-module.js","mappings":"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","sources":["webpack://post-blocks/external window [\"wp\",\"apiFetch\"]","webpack://post-blocks/external window [\"wp\",\"date\"]","webpack://post-blocks/webpack/bootstrap","webpack://post-blocks/webpack/runtime/compat get default export","webpack://post-blocks/webpack/runtime/define property getters","webpack://post-blocks/webpack/runtime/hasOwnProperty shorthand","webpack://post-blocks/./assets/front-module.js"],"sourcesContent":["module.exports = window[\"wp\"][\"apiFetch\"];","module.exports = window[\"wp\"][\"date\"];","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","import apiFetch from \"@wordpress/api-fetch\";\r\nimport {\r\n\tdateI18n, // 日付をフォーマットし、サイトのロケールに変換\r\n\tformat, // 日付のフォーマット\r\n} from \"@wordpress/date\";\r\n\r\n//RestAPIで投稿データを取得する関数（Promiseを返す）\r\nconst getEntityRecordsFromAPI = (entity, query) => {\r\n\tconst path = `/wp/v2/${entity}`;\r\n\tconst queryString = Object.entries(query)\r\n\t\t.map(([key, value]) => `${key}=${value}`)\r\n\t\t.join(\"&\");\r\n\r\n\treturn apiFetch({ path: `${path}?${queryString}` });\r\n};\r\n\r\n//RestAPIでメディア情報を取得する関数（Promiseを返す）\r\nconst getMediaInfoFromAPI = (mediaId) => {\r\n\tconst path = `/wp/v2/media/${mediaId}`;\r\n\treturn apiFetch({ path: path });\r\n};\r\n\r\nconst getSelectedTaxonomyTerms = (choiceTerms, taxRelateType) => {\r\n\tconst taxonomyTerms = choiceTerms.reduce((acc, { taxonomy, term }) => {\r\n\t\tif (taxonomy === \"category\") {\r\n\t\t\tif (acc.hasOwnProperty(\"categories\")) {\r\n\t\t\t\tacc[\"categories\"] = `${acc[\"categories\"]},${term.id}`;\r\n\t\t\t} else {\r\n\t\t\t\tacc[\"categories\"] = term.id;\r\n\t\t\t}\r\n\t\t} else if (taxonomy === \"post_tag\") {\r\n\t\t\tif (acc.hasOwnProperty(\"tags\")) {\r\n\t\t\t\tacc[\"tags\"] = `${acc[\"tags\"]},${term.id}`;\r\n\t\t\t} else {\r\n\t\t\t\tacc[\"tags\"] = term.id;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (acc.hasOwnProperty(taxonomy)) {\r\n\t\t\t\tacc[taxonomy] = `${acc[taxonomy]},${term.id}`;\r\n\t\t\t} else {\r\n\t\t\t\tacc[taxonomy] = term.id;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn acc;\r\n\t}, {});\r\n\r\n\treturn {\r\n\t\t...taxonomyTerms,\r\n\t\ttax_relation: taxRelateType,\r\n\t};\r\n};\r\n\r\nconst ModifyFieldElement = (element, post) => {\r\n\t// newPostUnitのすべての子要素を取得\r\n\tconst allElements = element.getElementsByTagName(\"*\");\r\n\r\n\t// 各要素を反復処理\r\n\tfor (let i = 0; i < allElements.length; i++) {\r\n\t\tconst element = allElements[i];\r\n\r\n\t\t// 要素のクラス名を取得\r\n\t\tconst classNames = element.className.split(\" \");\r\n\r\n\t\t// field_を含むクラス名があるかチェック\r\n\t\tconst hasFieldClass = classNames.some((className) =>\r\n\t\t\tclassName.startsWith(\"field_\"),\r\n\t\t);\r\n\r\n\t\tif (hasFieldClass) {\r\n\t\t\t// field_を含むクラス名がある場合、そのクラス内のDOM要素を書き換える\r\n\t\t\tconst fieldClassName = classNames.find((className) =>\r\n\t\t\t\tclassName.startsWith(\"field_\"),\r\n\t\t\t);\r\n\t\t\t// field_を除いたクラス名を取得\r\n\t\t\tconst fieldName = fieldClassName.replace(\"field_\", \"\");\r\n\t\t\t// postオブジェクト内で、そのクラス名をキーとする値を取得\r\n\t\t\tconst fieldValue = post[fieldName];\r\n\t\t\t//フィールドの種類によって書き換え方が変わる\r\n\t\t\tswitch (fieldName) {\r\n\t\t\t\tcase \"title\":\r\n\t\t\t\t\tconst hElement = element.querySelector(\"h1, h2, h3, h4, h5, h6\");\r\n\t\t\t\t\tif (hElement) {\r\n\t\t\t\t\t\t// h要素内のdivを探す\r\n\t\t\t\t\t\tconst divElement = hElement.querySelector(\"div\");\r\n\r\n\t\t\t\t\t\tif (divElement) {\r\n\t\t\t\t\t\t\t// divのテキストノードを書き換える\r\n\t\t\t\t\t\t\tdivElement.textContent = fieldValue.rendered;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"date\":\r\n\t\t\t\t\tconst dElement = element.querySelector(\"h1, h2, h3, h4, h5, h6\");\r\n\t\t\t\t\tif (dElement) {\r\n\t\t\t\t\t\t// h要素内のdivを探す\r\n\t\t\t\t\t\tconst divElement = dElement.querySelector(\"div\");\r\n\r\n\t\t\t\t\t\tif (divElement) {\r\n\t\t\t\t\t\t\t// divのテキストノードを書き換える\r\n\t\t\t\t\t\t\tdivElement.textContent = dateI18n(\"Y.n.j\", fieldValue);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"excerpt\":\r\n\t\t\t\t\t// pの内容を書き換える\r\n\t\t\t\t\telement.innerHTML = fieldValue.rendered;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"featured_media\":\r\n\t\t\t\t\tconst iElement = element.querySelector(\"img\");\r\n\t\t\t\t\tif (iElement) {\r\n\t\t\t\t\t\tgetMediaInfoFromAPI(fieldValue)\r\n\t\t\t\t\t\t\t.then((data) => {\r\n\t\t\t\t\t\t\t\t// imgのsrc属性を書き換える\r\n\t\t\t\t\t\t\t\tconst mediaUrl = data.media_details.sizes.medium.source_url;\r\n\t\t\t\t\t\t\t\tiElement.src = mediaUrl;\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.catch((error) => console.error(error));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n\t//PickUp Postの親要素を取得\r\n\tconst pickupElement = document.querySelectorAll(\r\n\t\t\".wp-block-itmar-pickup-posts\",\r\n\t);\r\n\r\n\t//エディタで設定された属性をdatasetで受け取ってクエリーの結果を取得\r\n\tpickupElement.forEach((pickup) => {\r\n\t\tconst numberOfItems = pickup.dataset.number_of_items;\r\n\t\tconst selectedRest = pickup.dataset.selected_rest;\r\n\t\tconst taxRelateType = pickup.dataset.tax_relate_type;\r\n\t\tconst choiceTerms = JSON.parse(pickup.dataset.choice_terms);\r\n\t\t//タームのセレクトオブジェクト\r\n\t\tconst selectTerms = getSelectedTaxonomyTerms(choiceTerms, taxRelateType);\r\n\t\t//RestAPIで結果を取得\r\n\t\tgetEntityRecordsFromAPI(selectedRest, {\r\n\t\t\tper_page: numberOfItems,\r\n\t\t\t...selectTerms,\r\n\t\t})\r\n\t\t\t.then((data) => {\r\n\t\t\t\tconst postUnits = pickup.querySelectorAll(\".post_unit\")[0];\r\n\t\t\t\tif (!postUnits) return; //post_unitクラスの要素がなければリターン\r\n\t\t\t\tconst postDivs = postUnits.children;\r\n\r\n\t\t\t\tdata.forEach((post, index) => {\r\n\t\t\t\t\t//非表示のクラスを外す\r\n\t\t\t\t\tpostUnits.classList.remove(\"unit_hide\");\r\n\t\t\t\t\t//レンダリング指定のあるフィールドの内容をpostの内容によって書き換え\r\n\t\t\t\t\tModifyFieldElement(postDivs[index], post);\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch((error) => console.error(error));\r\n\t});\r\n});\r\n"],"names":["module","exports","window","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","getMediaInfoFromAPI","mediaId","path","apiFetch","document","addEventListener","querySelectorAll","forEach","pickup","numberOfItems","dataset","number_of_items","selectedRest","selected_rest","taxRelateType","tax_relate_type","selectTerms","getSelectedTaxonomyTerms","choiceTerms","reduce","acc","taxonomy","term","id","tax_relation","JSON","parse","choice_terms","getEntityRecordsFromAPI","entity","query","queryString","entries","map","value","join","per_page","then","data","postUnits","postDivs","children","post","index","classList","remove","ModifyFieldElement","element","allElements","getElementsByTagName","i","length","classNames","className","split","some","startsWith","fieldName","find","replace","fieldValue","hElement","querySelector","divElement","textContent","rendered","dElement","dateI18n","innerHTML","iElement","mediaUrl","media_details","sizes","medium","source_url","src","catch","error","console"],"sourceRoot":""}